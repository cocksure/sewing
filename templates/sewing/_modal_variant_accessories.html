<div class="modal-header py-2">
	<h5 class="modal-title">Аксессуары: {{ variant.name }}</h5>
	<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<form method="post" action="{% url 'sewing:variant-accessories' variant.id %}">
	<div class="modal-body small">
		{% csrf_token %}
		{{ fs.management_form }}
		{% for form in fs.forms %}
			<div class="border rounded p-2 mb-2">
				<div class="row g-2">
					{% for f in form.visible_fields %}
						<div class="col-md-3">
							<label class="form-label mb-1">{{ f.label }}</label>{{ f }}
						</div>
					{% endfor %}
					{% if form.can_delete %}
						<div class="col-md-2 d-flex align-items-end">
							<label class="form-check-label me-2">Удалить</label>{{ form.DELETE }}
						</div>
					{% endif %}
				</div>
			</div>
		{% endfor %}
		<button type="button" class="btn btn-outline-success btn-sm" onclick="addRow('accs')">Добавить строку</button>
	</div>
	<div class="modal-footer py-2">
		<button class="btn btn-secondary btn-sm" data-bs-dismiss="modal" type="button">Отмена</button>
		<button class="btn btn-primary btn-sm" type="submit">Сохранить</button>
	</div>
</form>

<script>
    function addRow(prefix) {
        const total = document.getElementById('id_' + prefix + '-TOTAL_FORMS');
        const idx = parseInt(total.value, 10);
        const container = document.currentScript.closest('.modal-content').querySelector('.modal-body');
        const block = container.querySelectorAll('.border.rounded.p-2.mb-2');
        const last = block[block.length - 1];
        const clone = last.cloneNode(true);
        clone.querySelectorAll('input,select,textarea,label').forEach(el => {
            if (el.name) el.name = el.name.replace(new RegExp(prefix + '-\\d+-', 'g'), prefix + '-' + idx + '-');
            if (el.id) el.id = el.id.replace(new RegExp(prefix + '-\\d+-', 'g'), prefix + '-' + idx + '-');
            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                if (el.type === 'checkbox') el.checked = false; else el.value = '';
            }
            if (el.tagName === 'SELECT') el.selectedIndex = 0;
        });
        last.after(clone);
        total.value = idx + 1;
    }
</script>